<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hedef Bulucu Ok</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #1a1a1a;
            color: white;
            font-family: sans-serif;
            overflow: hidden;
        }

        #status { margin-bottom: 20px; text-align: center; padding: 0 20px; }

        #container {
            position: relative;
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #arrow {
            width: 0; 
            height: 0; 
            border-left: 40px solid transparent;
            border-right: 40px solid transparent;
            border-bottom: 80px solid #ff4757;
            transition: transform 0.1s ease-out;
            display: block;
        }

        #success {
            font-size: 100px;
            color: #2ed573;
            display: none;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="status">Konum izni bekleniyor...</div>

    <div id="container">
        <div id="arrow"></div>
        <div id="success">✔</div>
    </div>

    <script>
        // HEDEF KOORDİNATLAR (Burayı gitmek istediğin yerle değiştir)
        const target = {
            lat: 40.982377, // Örn: İstanbul
            lon: 29.130676
        };
        const threshold = 10; // Kaç metre kala tik işareti çıksın? (10 metre)

        let userCoords = null;
        let compassHeading = 0;

        const arrow = document.getElementById('arrow');
        const success = document.getElementById('success');
        const status = document.getElementById('status');

        // 1. Konum Takibi
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(position => {
                userCoords = {
                    lat: position.coords.latitude,
                    lon: position.coords.longitude
                };
                
                const distance = calculateDistance(userCoords.lat, userCoords.lon, target.lat, target.lon);
                status.innerHTML = `Hedefe uzaklık: <b>${Math.round(distance)} metre</b>`;

                if (distance <= threshold) {
                    arrow.classList.add('hidden');
                    success.style.display = 'block';
                } else {
                    arrow.classList.remove('hidden');
                    success.style.display = 'none';
                    updateRotation();
                }
            }, err => {
                status.innerText = "Konum alınamadı: " + err.message;
            }, { enableHighAccuracy: true });
        }

        // 2. Pusula Takibi (iOS için izin gerekebilir)
        window.addEventListener('deviceorientationabsolute', handleOrientation);
        window.addEventListener('deviceorientation', handleOrientation);

        function handleOrientation(event) {
            // alpha: cihazın z ekseni etrafındaki dönüşü (0-360)
            compassHeading = event.webkitCompassHeading || (360 - event.alpha);
            updateRotation();
        }

        function updateRotation() {
            if (!userCoords || !compassHeading) return;

            const bearing = calculateBearing(userCoords.lat, userCoords.lon, target.lat, target.lon);
            // Okun dönüş açısı = (Hedefin açısı) - (Telefonun baktığı yön)
            const arrowRotation = bearing - compassHeading;
            arrow.style.transform = `rotate(${arrowRotation}deg)`;
        }

        // Matematiksel Fonksiyonlar
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Dünya yarıçapı (metre)
            const φ1 = lat1 * Math.PI/180;
            const φ2 = lat2 * Math.PI/180;
            const Δφ = (lat2-lat1) * Math.PI/180;
            const Δλ = (lon2-lon1) * Math.PI/180;

            const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ/2) * Math.sin(Δλ/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function calculateBearing(lat1, lon1, lat2, lon2) {
            const φ1 = lat1 * Math.PI/180;
            const φ2 = lat2 * Math.PI/180;
            const λ1 = lon1 * Math.PI/180;
            const λ2 = lon2 * Math.PI/180;

            const y = Math.sin(λ2-λ1) * Math.cos(φ2);
            const x = Math.cos(φ1) * Math.sin(φ2) -
                      Math.sin(φ1) * Math.cos(φ2) * Math.cos(λ2-λ1);
            let bearing = Math.atan2(y, x) * 180 / Math.PI;
            return (bearing + 360) % 360;
        }
    </script>
</body>
</html>

